<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>2D Array 3D Plot · ArrayRadiation.jl</title><meta name="title" content="2D Array 3D Plot · ArrayRadiation.jl"/><meta property="og:title" content="2D Array 3D Plot · ArrayRadiation.jl"/><meta property="twitter:title" content="2D Array 3D Plot · ArrayRadiation.jl"/><meta name="description" content="Documentation for ArrayRadiation.jl."/><meta property="og:description" content="Documentation for ArrayRadiation.jl."/><meta property="twitter:description" content="Documentation for ArrayRadiation.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">ArrayRadiation.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">ArrayRadiation.jl</a></li><li><a class="tocitem" href="../../api_reference/">API Reference</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../element_radiation_pattern/">Element Radiation Pattern</a></li><li><a class="tocitem" href="../1D_array/">1D Array</a></li><li><a class="tocitem" href="../2D_array/">2D Array</a></li><li class="is-active"><a class="tocitem" href>2D Array 3D Plot</a></li><li><a class="tocitem" href="../linear_array_polar_gain_pattern/">Linear Array Polar Gain Pattern</a></li><li><a class="tocitem" href="../window_function/">Window Function</a></li><li><a class="tocitem" href="../monopulse_pattern/">Monopulse Pattern</a></li><li><a class="tocitem" href="../beem_steering/">Beam Steering</a></li></ul></li><li><a class="tocitem" href="../../coordinate_system/">Coordinate System</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>2D Array 3D Plot</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>2D Array 3D Plot</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/ErikBuer/ArrayRadiation.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/ErikBuer/ArrayRadiation.jl/blob/main/docs/src/Examples/2D_array_3D_plot.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="2D-Array-3D-Plot"><a class="docs-heading-anchor" href="#2D-Array-3D-Plot">2D Array 3D Plot</a><a id="2D-Array-3D-Plot-1"></a><a class="docs-heading-anchor-permalink" href="#2D-Array-3D-Plot" title="Permalink"></a></h1><pre><code class="language-julia hljs">using GLMakie
using Colors

using ArrayRadiation

# Define element spacing and array size
element_separation_λ = 1/2;
axis_element_count = 32;

# Generate antenna element positions
r_xyz = ArrayRadiation.antenna_matrix(axis_element_count, axis_element_count, element_separation_λ)

# Define angles in spherical coordinates
θs = range(0, π/2, length=361)  # Elevation angles
φs = range(-π, π,  length=361)  # Azimuth angles
angles = [(φ,θ) for φ in φs, θ in θs]

# Define element gain function
_element_gain(elevation) = AntennaElement.cos_taper(elevation, 1.4)

# Compute gain for each angle
_GΩ(θ, φ) = Kspace.gain(Kspace.k_xyz(θ, φ), AntennaElement.cos_taper(θ), r_xyz, ones(axis_element_count, axis_element_count))

# Compute k-space vectors and gain values
rs = [_GΩ(θ, φ) for (φ,θ) in angles]

# Convert the gain to dB
rs_dB = DspUtility.pow2db.(abs.(rs))

min_value_dB = -20
rs_dB = clamp.(rs_dB, min_value_dB, Inf)
rs_dB = rs_dB .- min_value_dB # Ensure there only are possitive values.

spherical_mesh = [(r,φ,θ) for (r,(φ,θ)) in zip(rs_dB, angles)]

# Convert spherical to Cartesian coordinates
xs = [r * sin(θ) * cos(φ) for (r, φ, θ) in spherical_mesh]
ys = [r * sin(θ) * sin(φ) for (r, φ, θ) in spherical_mesh]
zs = [r * cos(θ)          for (r, φ, θ) in spherical_mesh]

max_range = 1 + maximum(abs, vcat(xs, ys, zs))  # Find max value across all coordinates</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">51.102999566398125</code></pre><p>In order to plot the radiation pattern in 3D and dB, we need to clip the lowest values and bias the gain so it is purely positive. This makes the axis in the plot biased, but the relative scaling remains intact.</p><pre><code class="language-julia hljs"># Plot the 3D gain pattern
fig = Figure()
ax = Axis3(fig[1, 1], title=&quot;Array Gain Pattern [dB]&quot;)
limits!(ax, -max_range/2, max_range/2, -max_range/2, max_range/2, 0, max_range)
plt = surface!(ax, xs, ys, zs, color=rs_dB, colormap=:jet1)

fig</code></pre><img src="6016c466.png" alt="Example block output"/><p>To give some sense of the radiation pattern in relation to the array, let&#39;s draw a generic patch antenna array.</p><pre><code class="language-julia hljs">visual_scale = 3.0  # Scaling factor for visualization

patch_width  = 0.3163 * visual_scale # wavelengths
patch_length = 0.2207 * visual_scale # wavelengths

substrate_width  = axis_element_count * element_separation_λ * visual_scale
substrate_length = axis_element_count * element_separation_λ * visual_scale
substrate_thickness = 0.06   * visual_scale # wavelengths


# Draw substrate with teflon color (light off-white)
substrate_color = RGB(0.9, 0.9, 0.9)  # Light gray/teflon color
# Copper color for the patches
copper_color = RGB(0.72, 0.45, 0.2)  # Copper color (reddish-brown)

function rectangle(center_xyz::Vector, width::Float64, height::Float64)
    # Extract the center coordinates
    x_center, y_center, z_center = center_xyz

    # Define the half-width and half-height
    half_width = width / 2
    half_height = height / 2

    # Define the four corners of the rectangle (in the XY plane)
    vertices = [
        x_center - half_width  y_center - half_height z_center;  # Point 1
        x_center + half_width  y_center - half_height z_center;  # Point 2
        x_center + half_width  y_center + half_height z_center;  # Point 3
        x_center - half_width  y_center + half_height z_center   # Point 4
    ]

    # Define the two triangles (faces) making up the rectangle
    faces = [
        1 2 3;  # First triangle
        3 4 1   # Second triangle
    ]

    return (vertices, faces)
end


# Plot the substrate at z = 0
substrate_center = [0.0, 0.0, 0.0]
vertices_substrate, faces_substrate = rectangle(substrate_center, substrate_width, substrate_length)
mesh!(ax, vertices_substrate, faces_substrate, color=substrate_color, shading=NoShading)

# Plot each patch at positions specified in r_xyz
for element_pos in r_xyz
    _x, _y, _ = element_pos .* visual_scale
    # Each patch is placed at (x, y, 0) from r_xyz
    patch_center = [_x, _y, substrate_thickness]
    vertices_patch, faces_patch = rectangle(patch_center, patch_width, patch_length)

    # Plot the patch with copper color
    mesh!(ax, vertices_patch, faces_patch, color=copper_color, shading=NoShading)
end


# Hide axis
hidespines!(ax)
hidedecorations!(ax)
hidedecorations!(ax, ticks = false)
hidedecorations!(ax, grid = false)


# Display the figure
fig</code></pre><img src="9cf70855.png" alt="Example block output"/></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../2D_array/">« 2D Array</a><a class="docs-footer-nextpage" href="../linear_array_polar_gain_pattern/">Linear Array Polar Gain Pattern »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.9.0 on <span class="colophon-date" title="Sunday 23 March 2025 14:19">Sunday 23 March 2025</span>. Using Julia version 1.11.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
